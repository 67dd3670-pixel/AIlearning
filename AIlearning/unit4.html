<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’å¼è‹±è¯­é˜…è¯»å­¦ä¹  - åŠ¨æ€å†…å®¹æ¨¡æ¿</title>
    <!-- Tailwind CSS (æœ¬åœ°æ–‡ä»¶) -->
    <script src="libs/tailwindcss.min.js"></script>
    <script>
        // é…ç½®Tailwind CSS
        window.configureTailwind = function () {
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    theme: {
                        extend: {
                            colors: {
                                primary: '#6366f1',
                                secondary: '#ec4899',
                                accent: '#14b8a6',
                                dark: '#1e293b',
                                light: '#f8fafc',
                                'gradient-start': '#8b5cf6',
                                'gradient-end': '#06b6d4'
                            },
                            fontFamily: {
                                sans: ['Inter', 'system-ui', 'sans-serif'],
                            },
                            animation: {
                                'float': 'float 6s ease-in-out infinite',
                                'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                                'bounce-slow': 'bounce 2s infinite',
                                'fade-in': 'fadeIn 0.5s ease-in-out',
                                'slide-up': 'slideUp 0.6s ease-out'
                            },
                            keyframes: {
                                float: {
                                    '0%, 100%': { transform: 'translateY(0px)' },
                                    '50%': { transform: 'translateY(-10px)' }
                                },
                                fadeIn: {
                                    '0%': { opacity: '0' },
                                    '100%': { opacity: '1' }
                                },
                                slideUp: {
                                    '0%': { transform: 'translateY(20px)', opacity: '0' },
                                    '100%': { transform: 'translateY(0)', opacity: '1' }
                                }
                            }
                        }
                    }
                };
                console.log('Tailwind CSS é…ç½®å®Œæˆ');
            } else {
                console.warn('Tailwind CSS æœªèƒ½æ­£ç¡®åŠ è½½ï¼Œå°†ä½¿ç”¨å¤‡ç”¨æ ·å¼');
            }
        };

        // ç­‰å¾…TailwindåŠ è½½åé…ç½®
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(configureTailwind, 100);
            });
        } else {
            setTimeout(configureTailwind, 100);
        }
    </script>
    <!-- å¼•å…¥Interå­—ä½“ (æœ¬åœ°æ–‡ä»¶) -->
    <link rel="stylesheet" href="libs/fonts/inter.css">

    <!-- Font Awesome (æœ¬åœ°æ–‡ä»¶) -->
    <link rel="stylesheet" href="libs/font-awesome.min.css">

    <!-- SheetJSåº“ç”¨äºExcelå¯¼å‡º (æœ¬åœ°æ–‡ä»¶) -->
    <script src="libs/xlsx.full.min.js"></script>

    <!-- jsPDFåº“ç”¨äºPDFå¯¼å‡º (æœ¬åœ°æ–‡ä»¶) -->
    <script src="libs/jspdf.umd.min.js"></script>

    <!-- html2canvasç”¨äºæ”¯æŒä¸­æ–‡PDFå¯¼å‡º (æœ¬åœ°æ–‡ä»¶) -->
    <script src="libs/html2canvas.min.js"></script>

    <!-- å¼•å…¥é«˜çº§TTSåŠŸèƒ½åº“ -->
    <script src="pause-controller.js"></script>
    <script src="pitch-controller.js"></script>
    <script src="speed-controller.js"></script>
    <script src="emphasis-controller.js"></script>
    <script src="text-analyzer.js"></script>
    <script src="special-chars-processor.js"></script>
    <script src="ssml-generator.js"></script>
    <script src="advanced-tts-controller.js"></script>

    <!-- å¼•å…¥æ•°æ®å’Œæ¸²æŸ“å¼•æ“ -->
    <script src="unit4.js"></script>
    <script src="content-renderer.js"></script>
    <script src="data-uploader.js"></script>

    <!-- å¼•å…¥ç»ƒä¹ åŠŸèƒ½æ¨¡å— -->
    <script src="exercise-manager.js"></script>

    <!-- å¼•å…¥ç»ƒä¹ é¢˜æ•°æ® -->
    <script src="question.js"></script>


    <!-- å¤‡ç”¨åŸºç¡€æ ·å¼ -->
    <style>
        body {
            * {
                font-family: "Chalkboard", Arial, Helvetica, Arial, sans-serif;
            }

            .paragraph-content {
                color: #718096 !important;
                font-size: 18px !important;
            }
        }

        /* å¤‡ç”¨æ ·å¼ï¼Œä»¥é˜²Tailwind CSSåŠ è½½å¤±è´¥ */
        .bg-primary {
            background-color: #6366f1;
        }

        .bg-secondary {
            background-color: #ec4899;
        }

        .bg-accent {
            background-color: #14b8a6;
        }

        .bg-dark {
            background-color: #1e293b;
        }

        .bg-light {
            background-color: #f8fafc;
        }

        .text-primary {
            color: #6366f1;
        }

        .text-secondary {
            color: #ec4899;
        }

        .text-accent {
            color: #14b8a6;
        }

        .text-dark {
            color: #1e293b;
        }

        .text-light {
            color: #f8fafc;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background-color: #6366f1;
            color: white;
        }

        .btn-secondary {
            background-color: #ec4899;
            color: white;
        }

        .btn-accent {
            background-color: #14b8a6;
            color: white;
        }

        .p-4 {
            padding: 1rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .rounded {
            border-radius: 0.25rem;
        }

        .shadow {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* æŒ‰é’®æ•ˆæœ */
        .btn-effect {
            transition: all 0.3s ease;
        }

        .btn-effect:hover {
            transform: translateY(-2px);
        }

        /* å¡ç‰‡æ•ˆæœ */
        .card-shadow {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .vocab-item-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        /* æ¸å˜æ–‡æœ¬ */
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* è¯æ±‡å¡ç‰‡ */
        .vocab-card {
            transition: all 0.3s ease;
        }

        .vocab-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        /* æ–°å¢æ ·å¼ - éµå¾ªé˜…è¯»æ•™ç¨‹1U1.htmlçš„è®¾è®¡ */
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .neon-glow {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .animated-gradient {
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .para-title {
            position: relative;
            overflow: hidden;
        }

        .para-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #6366f1, #ec4899);
            transition: width 0.5s ease;
        }

        .para-title:hover::after {
            width: 100%;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
        }

        /* è¯æ±‡çŸ¥è¯†å•è¯é«˜äº®æ ·å¼ */
        .vocab-highlight {
            position: relative;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            display: inline-block;
        }

        .vocab-highlight:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* ä¸åŒè¯æ±‡ç±»åˆ«çš„é¢œè‰²æ–¹æ¡ˆ */
        .vocab-type-core {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border-bottom-color: #f59e0b;
        }

        .vocab-type-advanced {
            background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
            color: #5b21b6;
            border-bottom-color: #8b5cf6;
        }

        .vocab-type-business {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            color: #9f1239;
            border-bottom-color: #ec4899;
        }

        .vocab-type-academic {
            background: linear-gradient(135deg, #ccfbf1 0%, #99f6e4 100%);
            color: #134e4a;
            border-bottom-color: #14b8a6;
        }

        .vocab-type-common {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e3a8a;
            border-bottom-color: #3b82f6;
        }

        .vocab-type-technical {
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
            color: #7c2d12;
            border-bottom-color: #f97316;
        }

        /* è¯æ±‡æç¤ºæ¡†æ ·å¼ */
        .vocab-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            margin-bottom: 8px;
        }

        .vocab-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .vocab-highlight:hover .vocab-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* è¯æ€§å’Œå«ä¹‰åœ¨æç¤ºæ¡†ä¸­çš„æ ·å¼ - åŒè¡Œæ˜¾ç¤º */
        .vocab-tooltip-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vocab-pos {
            font-weight: 600;
            color: #a78bfa;
            font-size: 12px;
            white-space: nowrap;
        }

        .vocab-meaning {
            color: white;
            font-size: 14px;
        }

        /* æ–°å¢èƒŒæ™¯åŠ¨ç”»æ•ˆæœ */
        @keyframes blob {
            0% {
                transform: translate(0px, 0px) scale(1);
            }

            33% {
                transform: translate(30px, -50px) scale(1.1);
            }

            66% {
                transform: translate(-20px, 20px) scale(0.9);
            }

            100% {
                transform: translate(0px, 0px) scale(1);
            }
        }

        .animate-blob {
            animation: blob 8s ease-in-out infinite !important;
            position: absolute !important;
            display: block !important;
        }

        @keyframes shimmer {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }

            50% {
                opacity: 0.3;
            }

            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        .animate-shimmer {
            animation: shimmer 4s ease-in-out infinite !important;
            position: absolute !important;
            display: block !important;
        }

        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin-slow {
            animation: spin-slow 20s linear infinite !important;
            position: absolute !important;
            display: block !important;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.3;
                transform: scale(0.8);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        .animate-twinkle {
            animation: twinkle 3s ease-in-out infinite !important;
            position: absolute !important;
            display: block !important;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .animate-float {
            animation: float 6s ease-in-out infinite !important;
            position: absolute !important;
            display: block !important;
        }

        /* ä¼˜åŒ–ç§»åŠ¨ç«¯æ€§èƒ½ */
        @media (max-width: 768px) {

            .animate-blob,
            .animate-shimmer,
            .animate-spin-slow {
                animation-duration: 12s;
            }

            .animate-twinkle {
                animation-duration: 4s;
            }
        }

        /* é¼ æ ‡è·Ÿéšå…‰æ ‡æ•ˆæœ */
        .cursor-glow {
            position: fixed;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.3) 0%, transparent 70%);
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease-out;
            transform: translate(-50%, -50%);
        }

        /* é¡µé¢åŠ è½½åŠ¨ç”» */
        @keyframes pageLoad {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-load-animation {
            animation: pageLoad 0.8s ease-out forwards;
        }

        /* æ³¢çº¹æ‰©æ•£æ•ˆæœ */
        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }

            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            pointer-events: none;
            animation: ripple 0.6s ease-out;
        }

        /* æ‚¬æµ®å¡ç‰‡å¢å¼ºæ•ˆæœ */
        @keyframes cardFloat {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        .hover-float:hover {
            animation: cardFloat 3s ease-in-out infinite;
        }

        /* èƒŒæ™¯ç²’å­æ•ˆæœ */
        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0.3;
            z-index: 1;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.3;
            }

            90% {
                opacity: 0.3;
            }

            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* ç‚¹å‡»æ³¡æ³¡æ•ˆæœ */
        .click-bubble {
            position: fixed;
            pointer-events: none;
            z-index: 9998;
            border-radius: 50%;
            animation: bubbleGrow 0.8s ease-out forwards;
        }

        @keyframes bubbleGrow {
            0% {
                width: 0;
                height: 0;
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(0);
            }

            50% {
                width: 60px;
                height: 60px;
                opacity: 0.6;
                transform: translate(-50%, -50%) scale(1);
            }

            100% {
                width: 80px;
                height: 80px;
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.3);
            }
        }

        /* æ³¡æ³¡ç ´è£‚ç²’å­æ•ˆæœ */
        .bubble-particle {
            position: fixed;
            pointer-events: none;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            z-index: 9997;
            animation: particleBurst 1s ease-out forwards;
        }

        @keyframes particleBurst {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* æŒ‰é’®ç‚¹å‡»æ³¢çº¹æ•ˆæœ */
        .btn-ripple {
            position: relative;
            overflow: hidden;
        }

        .btn-ripple::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-ripple:active::before {
            width: 300px;
            height: 300px;
        }

        /* å‡å¼±åŠ¨ç”»æ•ˆæœä»¥å°Šé‡ç”¨æˆ·åå¥½ */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* å•è¯æ‹¼å†™åŠŸèƒ½æ ·å¼ */
        .spelling-letter-block {
            min-width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .spelling-letter-block:hover:not(.selected):not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .spelling-letter-block.selected {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transform: scale(0.95);
            opacity: 0.7;
            cursor: not-allowed;
        }

        .spelling-letter-block:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50">
    <!-- ç”¨æˆ·ä¿¡æ¯å½•å…¥æ¨¡æ€æ¡† -->
    <div id="user-info-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
        <div
            class="bg-gradient-to-br from-white via-purple-50 to-pink-50 rounded-3xl p-8 max-w-md w-full m-4 shadow-2xl border border-white/20 animate-slide-up">
            <div class="text-center mb-6">
                <div
                    class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mb-4">
                    <i class="fa fa-user text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold gradient-text mb-2">å­¦ç”Ÿä¿¡æ¯å½•å…¥</h2>
                <p class="text-gray-600 text-sm">è¯·è¾“å…¥æ‚¨çš„åŸºæœ¬ä¿¡æ¯ä»¥å¼€å§‹å­¦ä¹ </p>
            </div>
            <form id="user-info-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fa fa-graduation-cap mr-2 text-purple-500"></i>ç­çº§
                    </label>
                    <input type="text" id="user-class" name="class" required
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all"
                        placeholder="è¯·è¾“å…¥ç­çº§ï¼ˆå¦‚ï¼šè‹±è¯­1ç­ï¼‰">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fa fa-user mr-2 text-purple-500"></i>å§“å
                    </label>
                    <input type="text" id="user-name" name="name" required
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all"
                        placeholder="è¯·è¾“å…¥å§“å">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fa fa-id-card mr-2 text-purple-500"></i>å­¦å·
                    </label>
                    <input type="text" id="user-id" name="studentId" required
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all"
                        placeholder="è¯·è¾“å…¥å­¦å·">
                </div>
                <button type="submit"
                    class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                    <i class="fa fa-check mr-2"></i>ç¡®è®¤å¹¶å¼€å§‹å­¦ä¹ 
                </button>
            </form>
        </div>
    </div>
    <!-- è£…é¥°æ€§èƒŒæ™¯å…ƒç´  -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none" style="z-index: 1;">
        <!-- ä¸»è¦æµ®åŠ¨æ°”æ³¡ -->
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-float"
            style="animation-delay: 0s; z-index: 1;"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-float"
            style="animation-delay: 2s; z-index: 1;"></div>
        <div class="absolute top-1/2 left-1/2 w-80 h-80 bg-blue-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-float"
            style="animation-delay: 4s; z-index: 1;"></div>

        <!-- é¢å¤–çš„å°æ°”æ³¡è£…é¥° -->
        <div class="absolute top-20 left-20 w-32 h-32 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full opacity-20 animate-blob"
            style="animation-delay: 0s; z-index: 1;"></div>
        <div class="absolute top-40 right-32 w-24 h-24 bg-gradient-to-br from-blue-400 to-cyan-400 rounded-full opacity-15 animate-blob"
            style="animation-delay: 1s; z-index: 1;"></div>
        <div class="absolute bottom-32 left-40 w-40 h-40 bg-gradient-to-br from-pink-400 to-purple-400 rounded-full opacity-10 animate-blob"
            style="animation-delay: 3s; z-index: 1;"></div>
        <div class="absolute bottom-20 right-20 w-36 h-36 bg-gradient-to-br from-cyan-400 to-blue-400 rounded-full opacity-20 animate-blob"
            style="animation-delay: 5s; z-index: 1;"></div>

        <!-- å…‰æŸæ•ˆæœ -->
        <div class="absolute top-0 left-1/4 w-1 h-full bg-gradient-to-b from-transparent via-purple-300 to-transparent opacity-10 animate-shimmer"
            style="animation-delay: 0s; z-index: 1;"></div>
        <div class="absolute top-0 right-1/3 w-1 h-full bg-gradient-to-b from-transparent via-pink-300 to-transparent opacity-10 animate-shimmer"
            style="animation-delay: 2s; z-index: 1;"></div>

        <!-- æ—‹è½¬çš„è£…é¥°å…ƒç´  -->
        <div class="absolute top-1/4 right-1/4 w-16 h-16 border-2 border-purple-300 rounded-full opacity-20 animate-spin-slow"
            style="animation-delay: 0s; z-index: 1;"></div>
        <div class="absolute bottom-1/3 left-1/3 w-12 h-12 border-2 border-pink-300 rounded-full opacity-15 animate-spin-slow"
            style="animation-delay: 1s; animation-direction: reverse; z-index: 1;"></div>

        <!-- æ˜Ÿæ˜Ÿç‚¹ç‚¹æ•ˆæœ -->
        <div class="absolute top-10 left-10 w-2 h-2 bg-white rounded-full opacity-60 animate-twinkle"
            style="animation-delay: 0s; z-index: 1;"></div>
        <div class="absolute top-32 right-20 w-1.5 h-1.5 bg-white rounded-full opacity-40 animate-twinkle"
            style="animation-delay: 0.5s; z-index: 1;"></div>
        <div class="absolute bottom-40 left-32 w-2.5 h-2.5 bg-white rounded-full opacity-50 animate-twinkle"
            style="animation-delay: 1.5s; z-index: 1;"></div>
        <div class="absolute bottom-20 right-40 w-1.8 h-1.8 bg-white rounded-full opacity-45 animate-twinkle"
            style="animation-delay: 2.5s; z-index: 1;"></div>
        <div class="absolute top-1/2 left-20 w-2.2 h-2.2 bg-white rounded-full opacity-55 animate-twinkle"
            style="animation-delay: 3s; z-index: 1;"></div>
    </div>

    <header class="relative animated-gradient text-white py-12 px-4 md:px-8 shadow-2xl">
        <div class="max-w-6xl mx-auto relative z-10">
            <!-- åˆ†æ•°æ˜¾ç¤ºï¼ˆå³ä¸Šè§’ï¼‰ -->
            <div class="absolute top-4 right-4 md:top-6 md:right-6 z-20 flex flex-col gap-3">
                <div class="bg-white/20 backdrop-blur-sm rounded-2xl px-6 py-4 shadow-lg border border-white/30">
                    <div class="text-center">
                        <div class="text-sm text-white/80 mb-1">å½“å‰å¾—åˆ†</div>
                        <div class="text-3xl font-bold text-white" id="current-score">0</div>
                        <div class="text-xs text-white/70 mt-1">
                            <span id="score-details">0 / 0 é¢˜</span>
                        </div>
                    </div>
                </div>
                <!-- å¯¼å‡ºPDFæŒ‰é’® -->
                <div id="export-pdf-section" class="hidden">
                    <button id="export-pdf-btn"
                        class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2 text-sm whitespace-nowrap border border-white/30">
                        <i class="fa fa-file-pdf-o"></i>
                        <span>å¯¼å‡ºæŠ¥å‘Š</span>
                    </button>
                </div>
            </div>
            <div class="text-center mb-6">
                <div
                    class="inline-flex items-center justify-center w-20 h-20 bg-white/20 rounded-full backdrop-blur-sm mb-4 animate-pulse-slow">
                    <i class="fa fa-graduation-cap text-4xl"></i>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold mb-3 animate-fade-in">
                    äº¤äº’å¼è‹±è¯­é˜…è¯»å­¦ä¹ å¹³å°
                </h1>
                <p class="text-xl text-white/90 mb-6 animate-slide-up">
                    <span id="course-unit">Unit 1</span> <span id="course-title">Take Over</span>
                </p>
                <div class="flex justify-center gap-4 animate-slide-up" style="animation-delay: 0.2s;">
                    <span class="px-4 py-2 bg-white/20 rounded-full backdrop-blur-sm text-sm">
                        <i class="fa fa-book mr-2"></i>æ–‡ç« ç²¾è¯»
                    </span>
                    <span class="px-4 py-2 bg-white/20 rounded-full backdrop-blur-sm text-sm">
                        <i class="fa fa-volume-up mr-2"></i>è¯­éŸ³æœ—è¯»
                    </span>
                    <span class="px-4 py-2 bg-white/20 rounded-full backdrop-blur-sm text-sm">
                        <i class="fa fa-bookmark mr-2"></i>è¯æ±‡æ”¶è—
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <div class="max-w-6xl mx-auto px-4 md:px-8 relative z-10 mt-6">
        <div class="flex gap-4 bg-white/80 backdrop-blur-sm rounded-2xl p-2 shadow-lg border border-white/20">
            <button id="tab-reading"
                class="tab-btn flex-1 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                <i class="fa fa-book"></i>
                <span>é˜…è¯»</span>
            </button>
            <button id="tab-exercise"
                class="tab-btn flex-1 px-6 py-4 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2">
                <i class="fa fa-pencil"></i>
                <span>ç»ƒä¹ </span>
            </button>
        </div>
    </div>

    <main class="max-w-6xl mx-auto py-8 px-4 md:px-8 relative z-10">
        <!-- é˜…è¯»å†…å®¹åŒºåŸŸ -->
        <div id="reading-content" class="tab-content">
            <!-- é˜…è¯»æ¨¡å¼å­æ ‡ç­¾å¯¼èˆª -->
            <div class="mb-6">
                <div class="flex gap-4 bg-white/80 backdrop-blur-sm rounded-2xl p-2 shadow-lg border border-white/20">
                    <button id="sub-tab-original"
                        class="sub-tab-btn flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fa fa-file-text"></i>
                        <span>åŸæ–‡é˜…è¯»</span>
                    </button>
                    <button id="sub-tab-annotated"
                        class="sub-tab-btn flex-1 px-6 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fa fa-book"></i>
                        <span>æ³¨é‡Šé˜…è¯»</span>
                    </button>
                </div>
            </div>

            <!-- åŸæ–‡é˜…è¯»å†…å®¹åŒºåŸŸ -->
            <div id="original-reading-content" class="sub-tab-content">
                <div class="bg-white rounded-2xl p-8 shadow-lg border border-gray-200">
                    <div class="mb-6 text-center">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">A Note on the Slowness of the English
                            Character</h2>
                        <p class="text-lg text-gray-600 mb-2">E. M. Forster</p>
                        <p class="text-sm text-gray-500">
                            <i class="fa fa-clock-o mr-1"></i>
                            å»ºè®®é˜…è¯»æ—¶é—´ï¼šçº¦ 9 åˆ†é’Ÿ
                        </p>
                    </div>
                    <div id="original-text-content"
                        class="prose prose-lg max-w-none text-gray-700 leading-relaxed whitespace-pre-line">
                        <!-- åŸæ–‡å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
            </div>

            <!-- æ³¨é‡Šé˜…è¯»å†…å®¹åŒºåŸŸï¼ˆéœ€è¦å¯†ç ï¼‰ -->
            <div id="annotated-reading-content" class="sub-tab-content hidden">
                <!-- å¯†ç éªŒè¯æ¨¡æ€æ¡† -->
                <div id="password-modal"
                    class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
                    <div
                        class="bg-gradient-to-br from-white via-blue-50 to-cyan-50 rounded-3xl p-8 max-w-md w-full m-4 shadow-2xl border border-white/20 animate-slide-up">
                        <div class="text-center mb-6">
                            <div
                                class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full mb-4">
                                <i class="fa fa-lock text-white text-2xl"></i>
                            </div>
                            <h2 class="text-2xl font-bold gradient-text mb-2">å¯†ç éªŒè¯</h2>
                            <p class="text-gray-600 text-sm">è¯·è¾“å…¥å¯†ç ä»¥è®¿é—®æ³¨é‡Šé˜…è¯»åŠŸèƒ½</p>
                        </div>
                        <form id="password-form" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <i class="fa fa-key mr-2 text-blue-500"></i>å¯†ç 
                                </label>
                                <input type="password" id="password-input" name="password" required
                                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all text-center text-lg font-mono"
                                    placeholder="è¯·è¾“å…¥æ•°å­—å¯†ç " autocomplete="off">
                            </div>
                            <button type="submit"
                                class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                <i class="fa fa-check mr-2"></i>éªŒè¯å¹¶è¿›å…¥
                            </button>
                            <button type="button" id="cancel-password-btn"
                                class="w-full bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-bold hover:bg-gray-300 transition-all duration-300">
                                å–æ¶ˆ
                            </button>
                        </form>
                        <div id="password-error" class="mt-4 text-red-500 text-sm text-center hidden"></div>
                    </div>
                </div>

                <!-- æ³¨é‡Šé˜…è¯»åŠŸèƒ½åŒºåŸŸï¼ˆå¯†ç éªŒè¯åæ˜¾ç¤ºï¼‰ -->
                <div id="annotated-content-wrapper" class="hidden">
                    <!-- æ®µè½å¯¼èˆªå’Œæ”¶è—åŠŸèƒ½åŒº -->
                    <div class="mb-10 glass-effect rounded-2xl p-6 neon-glow animate-slide-up"
                        style="animation-delay: 0.4s;">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                            <div class="flex-1">
                                <div class="mb-4">
                                    <h2 class="text-2xl font-bold gradient-text para-title">ğŸ“š æ®µè½å¯¼èˆª</h2>
                                    <p class="text-sm text-gray-600 mt-1">ç‚¹å‡»ä»»æ„æ®µè½æŒ‰é’®ç›´æ¥è·³è½¬åˆ°å¯¹åº”æ®µè½</p>
                                </div>
                                <div id="paragraph-nav-container"
                                    class="grid grid-cols-4 sm:grid-cols-5 md:grid-cols-7 lg:grid-cols-8 gap-2">
                                    <!-- æ®µè½å¯¼èˆªæŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>

                            <!-- æ”¶è—è¯æ±‡åŠŸèƒ½åŒº -->
                            <div class="flex flex-col gap-3 lg:ml-6">
                                <button id="view-collection"
                                    class="group bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-4 rounded-2xl flex items-center justify-center btn-effect font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                    <i class="fa fa-bookmark mr-3 text-xl"></i>
                                    <div class="text-left">
                                        <div class="text-sm">æŸ¥çœ‹æ”¶è—</div>
                                        <div class="text-xs opacity-90">è¯æ±‡ç®¡ç†</div>
                                    </div>
                                    <span id="collection-count"
                                        class="ml-3 bg-white text-orange-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold shadow-md">0</span>
                                </button>
                                <button id="export-collection"
                                    class="group bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-2xl flex items-center justify-center btn-effect font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                    <i class="fa fa-download mr-3 text-xl"></i>
                                    <div class="text-left">
                                        <div class="text-sm">å¯¼å‡º</div>
                                        <div class="text-xs opacity-90">Excelæ–‡ä»¶</div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- æ®µè½å†…å®¹åˆ†é¡µå®¹å™¨ -->
                    <div id="content-container">
                        <!-- æ®µè½å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                    </div>

                    <!-- é¡µé¢åˆ†é¡µæ§åˆ¶ -->
                    <div class="flex justify-center mt-8 mb-12">
                        <div
                            class="flex items-center gap-4 bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-white/20">
                            <button id="prev-page"
                                class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl flex items-center justify-center btn-effect disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 shadow-md hover:shadow-xl">
                                <i class="fa fa-chevron-left"></i>
                            </button>
                            <div class="text-center">
                                <div class="text-sm font-medium text-gray-700">
                                    ç¬¬ <span id="current-page" class="font-bold text-purple-600">1</span> / <span
                                        id="total-pages" class="font-bold text-purple-600">1</span> é¡µ
                                </div>
                                <div class="text-xs text-gray-500 mt-1">é¡µé¢å¯¼èˆª</div>
                            </div>
                            <button id="next-page"
                                class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl flex items-center justify-center btn-effect disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 shadow-md hover:shadow-xl">
                                <i class="fa fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»ƒä¹ å†…å®¹åŒºåŸŸ -->
        <div id="exercise-content" class="tab-content hidden">
            <!-- ç»ƒä¹ ç±»å‹é€‰æ‹©æ ‡ç­¾ -->
            <div class="mb-6">
                <div class="flex gap-4 bg-white/80 backdrop-blur-sm rounded-2xl p-2 shadow-lg border border-white/20">
                    <button id="exercise-tab-practice"
                        class="exercise-tab-btn flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fa fa-pencil"></i>
                        <span>ç»¼åˆç»ƒä¹ </span>
                    </button>
                    <button id="exercise-tab-spelling"
                        class="exercise-tab-btn flex-1 px-6 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="fa fa-keyboard-o"></i>
                        <span>å•è¯æ‹¼å†™</span>
                    </button>
                </div>
            </div>

            <!-- ç»¼åˆç»ƒä¹ åŒºåŸŸ -->
            <div id="practice-exercise-content" class="exercise-sub-content">
                <div class="mb-10 glass-effect rounded-2xl p-6 neon-glow animate-slide-up">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold gradient-text para-title mb-4">ğŸ“ ç»¼åˆç»ƒä¹ </h2>
                        <p class="text-gray-600">é€šè¿‡ç»ƒä¹ å·©å›ºæ‰€å­¦çŸ¥è¯†ï¼Œæé«˜è‹±è¯­åº”ç”¨èƒ½åŠ›</p>
                    </div>

                    <!-- ç»ƒä¹ ç±»å‹é€‰æ‹© -->
                    <div class="flex flex-wrap justify-center gap-4 mb-8">
                        <button
                            class="exercise-type-btn active bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                            data-type="shortAnswer">
                            <i class="fa fa-edit mr-2"></i>ç®€ç­”é¢˜
                        </button>
                        <button
                            class="exercise-type-btn bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                            data-type="reading">
                            <i class="fa fa-book mr-2"></i>é˜…è¯»ç†è§£
                        </button>
                        <button
                            class="exercise-type-btn bg-gradient-to-r from-red-500 to-pink-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                            data-type="fillBlank">
                            <i class="fa fa-clone mr-2"></i>å¡«ç©ºé¢˜
                        </button>
                        <button
                            class="exercise-type-btn bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                            data-type="grammar">
                            <i class="fa fa-code mr-2"></i>è¯­æ³•é¢˜
                        </button>
                    </div>

                    <!-- ç»ƒä¹ é¢˜ç›®å®¹å™¨ -->
                    <div id="exercise-container" class="space-y-6">
                        <!-- ç»ƒä¹ é¢˜ç›®å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                    </div>

                    <!-- ç»Ÿä¸€æäº¤æŒ‰é’®åŒºåŸŸ -->
                    <div class="mt-8 flex justify-center">
                        <div class="w-full max-w-md">
                            <button id="submit-current-type-btn"
                                class="submit-current-type-btn w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-4 rounded-2xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed text-lg">
                                <i class="fa fa-check-circle"></i>
                                <span id="submit-btn-text">æäº¤å½“å‰é¢˜å‹æ‰€æœ‰ç­”æ¡ˆ</span>
                            </button>
                            <div class="mt-3 text-center text-sm text-gray-600">
                                <span id="submit-status-display" class="submit-status-display">æœªæäº¤</span>
                            </div>
                        </div>
                    </div>

                    <!-- è¯„åˆ†ç»“æœåŒºåŸŸ -->
                    <div id="exercise-result"
                        class="hidden mt-6 w-full bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
                        <!-- è¯„åˆ†ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
            </div>

            <!-- å•è¯æ‹¼å†™åŒºåŸŸ -->
            <div id="spelling-exercise-content" class="exercise-sub-content hidden">
                <div class="mb-10 glass-effect rounded-2xl p-6 neon-glow animate-slide-up">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold gradient-text para-title mb-4">âŒ¨ï¸ å•è¯æ‹¼å†™æŒ‘æˆ˜</h2>
                        <p class="text-gray-600">é€šè¿‡æ‹¼å†™å•è¯å·©å›ºè¯æ±‡è®°å¿†ï¼Œæé«˜å•è¯æ‹¼å†™èƒ½åŠ›</p>
                    </div>

                    <!-- å•è¯æ‹¼å†™æ¸¸æˆå®¹å™¨ -->
                    <div id="spelling-game-container" class="spelling-game-container">
                        <!-- æ¸¸æˆçŠ¶æ€æ˜¾ç¤º -->
                        <div class="flex justify-center gap-6 mb-6">
                            <div
                                class="bg-white/80 backdrop-blur-sm rounded-xl px-6 py-3 shadow-lg border border-white/20 text-center">
                                <div class="text-sm text-gray-600 mb-1">æ­£ç¡®ç‡</div>
                                <div class="text-2xl font-bold text-purple-600" id="spelling-score">0%</div>
                            </div>
                            <div
                                class="bg-white/80 backdrop-blur-sm rounded-xl px-6 py-3 shadow-lg border border-white/20 text-center">
                                <div class="text-sm text-gray-600 mb-1">è¿›åº¦</div>
                                <div class="text-2xl font-bold text-blue-600" id="spelling-progress">0 / 0</div>
                            </div>
                        </div>

                        <!-- æç¤ºåŒºåŸŸ -->
                        <div
                            class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-2xl p-6 mb-6 text-center shadow-lg">
                            <div class="text-sm text-gray-600 mb-2">ä¸­æ–‡æç¤º</div>
                            <div class="text-2xl font-bold text-gray-800" id="spelling-hint">ç‚¹å‡»å¼€å§‹æŒ‰é’®å¼€å§‹æ‹¼å†™æŒ‘æˆ˜</div>
                        </div>

                        <!-- è¾“å…¥æ¡† -->
                        <div class="mb-6">
                            <input type="text" id="spelling-input" readonly
                                class="w-full px-6 py-4 text-2xl font-mono text-center rounded-2xl border-2 border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all bg-white shadow-lg"
                                placeholder="ç‚¹å‡»ä¸‹æ–¹å­—æ¯å—æ‹¼å†™å•è¯">
                        </div>

                        <!-- å­—æ¯å—å®¹å™¨ -->
                        <div id="spelling-letters-container"
                            class="flex flex-wrap justify-center gap-3 mb-6 min-h-[80px]">
                            <!-- å­—æ¯å—å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- æ“ä½œæŒ‰é’® -->
                        <div class="flex flex-wrap justify-center gap-4 mb-6">
                            <button id="spelling-check-btn" disabled
                                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa fa-check mr-2"></i>æ£€æŸ¥æ‹¼å†™
                            </button>
                            <button id="spelling-delete-btn" disabled
                                class="bg-gradient-to-r from-red-500 to-pink-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa fa-arrow-left mr-2"></i>åˆ é™¤
                            </button>
                            <button id="spelling-retry-btn" disabled
                                class="bg-gradient-to-r from-yellow-500 to-orange-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa fa-refresh mr-2"></i>é‡è¯•
                            </button>
                            <button id="spelling-next-btn" disabled
                                class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa fa-arrow-right mr-2"></i>ä¸‹ä¸€ä¸ª
                            </button>
                            <button id="spelling-giveup-btn" disabled
                                class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa fa-times mr-2"></i>æ”¾å¼ƒ
                            </button>
                        </div>

                        <!-- å¼€å§‹æŒ‰é’® -->
                        <div class="text-center">
                            <button id="spelling-start-btn"
                                class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-12 py-4 rounded-2xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-lg">
                                <i class="fa fa-play mr-2"></i>å¼€å§‹æ‹¼å†™æŒ‘æˆ˜
                            </button>
                        </div>

                        <!-- å®Œæˆæç¤º -->
                        <div id="spelling-complete" class="hidden text-center mt-6">
                            <div
                                class="bg-gradient-to-r from-green-400 to-emerald-500 text-white rounded-2xl p-6 shadow-lg">
                                <i class="fa fa-trophy text-4xl mb-4"></i>
                                <h3 class="text-2xl font-bold mb-2">æ­å–œå®Œæˆï¼</h3>
                                <p class="text-lg mb-4">æœ€ç»ˆæ­£ç¡®ç‡: <span id="spelling-final-score">0%</span></p>
                                <button id="spelling-export-pdf-btn"
                                    class="bg-white text-green-600 px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                    <i class="fa fa-file-pdf-o mr-2"></i>å¯¼å‡ºæ‹¼å†™æŠ¥å‘Š
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- æ”¶è—è¯æ±‡æ¨¡æ€æ¡† -->
    <div id="collection-modal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div
            class="bg-gradient-to-br from-white via-purple-50 to-pink-50 rounded-3xl p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto m-4 shadow-2xl border border-white/20 animate-slide-up">
            <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
            <div class="flex justify-between items-center mb-6 pb-3 border-b border-purple-200">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center shadow-lg">
                        <i class="fa fa-bookmark text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold gradient-text">æˆ‘çš„æ”¶è—è¯æ±‡</h3>
                        <p class="text-gray-600 text-xs mt-1">ç®¡ç†å’Œå¯¼å‡ºæ‚¨æ”¶è—çš„å­¦ä¹ è¯æ±‡</p>
                    </div>
                </div>
                <button id="close-modal"
                    class="w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center btn-effect transition-all duration-300 hover:scale-110">
                    <i class="fa fa-times text-gray-600"></i>
                </button>
            </div>

            <!-- ç©ºçŠ¶æ€ -->
            <div id="empty-collection" class="py-12 text-center hidden">
                <div
                    class="w-20 h-20 bg-gradient-to-r from-purple-200 to-pink-200 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse-slow">
                    <i class="fa fa-bookmark-o text-3xl text-purple-600"></i>
                </div>
                <h4 class="text-lg font-semibold text-gray-700 mb-2">è¿˜æ²¡æœ‰æ”¶è—è¯æ±‡</h4>
                <p class="text-gray-500 mb-4 text-sm">ç‚¹å‡»è¯æ±‡æ—çš„ä¹¦ç­¾å›¾æ ‡å¼€å§‹æ”¶è—æ‚¨æ„Ÿå…´è¶£çš„å•è¯å§ï¼</p>
                <button
                    class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-5 py-2 rounded-lg btn-effect font-medium shadow-lg text-sm">
                    <i class="fa fa-book mr-2"></i>å¼€å§‹å­¦ä¹ 
                </button>
            </div>

            <!-- æ”¶è—è¯æ±‡åˆ—è¡¨ -->
            <div id="collection-list" class="grid md:grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- æ”¶è—çš„è¯æ±‡å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
            </div>

            <!-- åº•éƒ¨æ“ä½œæ  -->
            <div class="mt-6 pt-4 border-t border-purple-200 flex justify-between items-center">
                <div class="flex items-center gap-2 text-sm text-gray-600">
                    <i class="fa fa-info-circle mr-2"></i>
                    å…±æ”¶è— <span id="modal-collection-count" class="font-semibold text-purple-600">0</span> ä¸ªè¯æ±‡
                </div>
                <div class="flex gap-3">
                    <button id="clear-collection"
                        class="bg-red-100 hover:bg-red-200 text-red-600 px-6 py-3 rounded-xl flex items-center btn-effect font-medium transition-all duration-300">
                        <i class="fa fa-trash mr-2"></i> æ¸…ç©ºæ”¶è—
                    </button>
                    <button id="export-from-modal"
                        class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl flex items-center btn-effect font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                        <i class="fa fa-download mr-2"></i> å¯¼å‡ºä¸ºExcel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
    <div class="fixed bottom-6 right-6 z-40">
        <button id="collection-btn"
            class="w-14 h-14 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full flex items-center justify-center btn-effect shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300 relative">
            <i class="fa fa-bookmark text-xl"></i>
            <span id="collection-badge"
                class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold">0</span>
        </button>
    </div>

    <!-- æ–°å¢çš„åŠé€æ˜æ‚¬æµ®çª— -->
    <div id="floating-window"
        class="fixed bottom-24 right-6 z-50 w-80 max-w-sm rounded-2xl bg-white/70 backdrop-blur-lg border border-white/30 shadow-2xl transition-all duration-300 transform-gpu hover:scale-105 hover:shadow-2xl">
        <div class="p-5">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">
                    <i class="fa fa-info-circle mr-2 text-purple-500"></i>
                    å­¦ä¹ æç¤º
                </h3>
                <button id="close-floating-window"
                    class="w-8 h-8 bg-gray-200/50 hover:bg-gray-300/70 rounded-full flex items-center justify-center transition-all duration-300 text-gray-600 hover:text-gray-800">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="text-gray-700 text-sm leading-relaxed">
                <p>è¿™æ˜¯ä¸€ä¸ªå¯å…³é—­çš„æ‚¬æµ®çª—å£ï¼Œç”¨äºå±•ç¤ºé‡è¦çš„å­¦ä¹ æç¤ºæˆ–é€šçŸ¥ã€‚</p>
                <ul class="mt-3 list-disc list-inside space-y-1">
                    <li>ä¸é®æŒ¡å·²æœ‰æŒ‰é’®</li>
                    <li>ç²¾ç¾çš„åŠé€æ˜UI</li>
                    <li>å¯è‡ªå®šä¹‰å†…å®¹</li>
                </ul>
            </div>
        </div>
    </div>


    <!-- åˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
        function initTabNavigation() {
            const tabReading = document.getElementById('tab-reading');
            const tabExercise = document.getElementById('tab-exercise');
            const readingContent = document.getElementById('reading-content');
            const exerciseContent = document.getElementById('exercise-content');

            if (!tabReading || !tabExercise || !readingContent || !exerciseContent) {
                console.warn('æ ‡ç­¾é¡µå…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            function switchTab(tab) {
                if (tab === 'reading') {
                    tabReading.className = 'tab-btn flex-1 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2';
                    tabExercise.className = 'tab-btn flex-1 px-6 py-4 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2';
                    readingContent.classList.remove('hidden');
                    exerciseContent.classList.add('hidden');
                } else if (tab === 'exercise') {
                    tabReading.className = 'tab-btn flex-1 px-6 py-4 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2';
                    tabExercise.className = 'tab-btn flex-1 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2';
                    readingContent.classList.add('hidden');
                    exerciseContent.classList.remove('hidden');

                    // åˆ‡æ¢åˆ°ç»ƒä¹ æ ‡ç­¾æ—¶åˆå§‹åŒ–ç»ƒä¹ ç®¡ç†å™¨
                    if (typeof window.exerciseManager !== 'undefined' && !window.exerciseManager.initialized) {
                        window.exerciseManager.init();
                    }
                }
            }

            tabReading.addEventListener('click', () => switchTab('reading'));
            tabExercise.addEventListener('click', () => switchTab('exercise'));
        }

        // ç»ƒä¹ ç±»å‹å­æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        function initExerciseTabNavigation() {
            const exerciseTabPractice = document.getElementById('exercise-tab-practice');
            const exerciseTabSpelling = document.getElementById('exercise-tab-spelling');
            const practiceContent = document.getElementById('practice-exercise-content');
            const spellingContent = document.getElementById('spelling-exercise-content');

            if (!exerciseTabPractice || !exerciseTabSpelling || !practiceContent || !spellingContent) {
                console.warn('ç»ƒä¹ å­æ ‡ç­¾é¡µå…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            function switchExerciseTab(tab) {
                if (tab === 'practice') {
                    exerciseTabPractice.className = 'exercise-tab-btn flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2';
                    exerciseTabSpelling.className = 'exercise-tab-btn flex-1 px-6 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2';
                    practiceContent.classList.remove('hidden');
                    spellingContent.classList.add('hidden');
                } else if (tab === 'spelling') {
                    exerciseTabPractice.className = 'exercise-tab-btn flex-1 px-6 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2';
                    exerciseTabSpelling.className = 'exercise-tab-btn flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2';
                    practiceContent.classList.add('hidden');
                    spellingContent.classList.remove('hidden');
                }
            }

            exerciseTabPractice.addEventListener('click', () => switchExerciseTab('practice'));
            exerciseTabSpelling.addEventListener('click', () => switchExerciseTab('spelling'));
        }

        // é˜…è¯»æ¨¡å¼å­æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
        function initSubTabNavigation() {
            const subTabOriginal = document.getElementById('sub-tab-original');
            const subTabAnnotated = document.getElementById('sub-tab-annotated');
            const originalContent = document.getElementById('original-reading-content');
            const annotatedContent = document.getElementById('annotated-reading-content');

            if (!subTabOriginal || !subTabAnnotated || !originalContent || !annotatedContent) {
                console.warn('é˜…è¯»å­æ ‡ç­¾é¡µå…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            function switchSubTab(tab) {
                if (tab === 'original') {
                    subTabOriginal.className = 'sub-tab-btn flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2';
                    subTabAnnotated.className = 'sub-tab-btn flex-1 px-6 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2';
                    originalContent.classList.remove('hidden');
                    annotatedContent.classList.add('hidden');
                } else if (tab === 'annotated') {
                    subTabOriginal.className = 'sub-tab-btn flex-1 px-6 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all duration-300 flex items-center justify-center gap-2';
                    subTabAnnotated.className = 'sub-tab-btn flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl font-bold shadow-lg transition-all duration-300 flex items-center justify-center gap-2';
                    originalContent.classList.add('hidden');
                    annotatedContent.classList.remove('hidden');

                    // æ£€æŸ¥æ˜¯å¦å·²é€šè¿‡å¯†ç éªŒè¯
                    const passwordVerified = sessionStorage.getItem('annotatedReadingVerified') === 'true';
                    if (!passwordVerified) {
                        showPasswordModal();
                    } else {
                        showAnnotatedContent();
                    }
                }
            }

            subTabOriginal.addEventListener('click', () => switchSubTab('original'));
            subTabAnnotated.addEventListener('click', () => switchSubTab('annotated'));
        }

        // æ˜¾ç¤ºå¯†ç éªŒè¯æ¨¡æ€æ¡†
        function showPasswordModal() {
            const passwordModal = document.getElementById('password-modal');
            const annotatedWrapper = document.getElementById('annotated-content-wrapper');
            if (passwordModal) {
                passwordModal.classList.remove('hidden');
                if (annotatedWrapper) {
                    annotatedWrapper.classList.add('hidden');
                }
            }
        }

        // éšè—å¯†ç éªŒè¯æ¨¡æ€æ¡†å¹¶æ˜¾ç¤ºæ³¨é‡Šå†…å®¹
        function showAnnotatedContent() {
            const passwordModal = document.getElementById('password-modal');
            const annotatedWrapper = document.getElementById('annotated-content-wrapper');
            if (passwordModal) {
                passwordModal.classList.add('hidden');
            }
            if (annotatedWrapper) {
                annotatedWrapper.classList.remove('hidden');
                // å¦‚æœå†…å®¹æ¸²æŸ“å™¨æœªåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–å®ƒ
                if (typeof window.contentRenderer !== 'undefined' && !window.contentRenderer.initialized) {
                    window.contentRenderer.init();
                }
            }
        }

        // å¯†ç éªŒè¯åŠŸèƒ½
        function initPasswordVerification() {
            const passwordForm = document.getElementById('password-form');
            const passwordInput = document.getElementById('password-input');
            const passwordError = document.getElementById('password-error');
            const cancelPasswordBtn = document.getElementById('cancel-password-btn');

            if (!passwordForm) return;

            passwordForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const password = passwordInput.value.trim();

                if (password === '1116') {
                    // å¯†ç æ­£ç¡®ï¼Œä¿å­˜éªŒè¯çŠ¶æ€
                    sessionStorage.setItem('annotatedReadingVerified', 'true');
                    passwordError.classList.add('hidden');
                    showAnnotatedContent();
                    passwordInput.value = '';
                } else {
                    // å¯†ç é”™è¯¯
                    passwordError.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼';
                    passwordError.classList.remove('hidden');
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            });

            // å–æ¶ˆæŒ‰é’®
            if (cancelPasswordBtn) {
                cancelPasswordBtn.addEventListener('click', function () {
                    const passwordModal = document.getElementById('password-modal');
                    if (passwordModal) {
                        passwordModal.classList.add('hidden');
                    }
                    // åˆ‡æ¢å›åŸæ–‡é˜…è¯»
                    const subTabOriginal = document.getElementById('sub-tab-original');
                    if (subTabOriginal) {
                        subTabOriginal.click();
                    }
                });
            }
        }

        // åŠ è½½åŸæ–‡å†…å®¹
        function loadOriginalText() {
            const originalTextContent = document.getElementById('original-text-content');
            if (!originalTextContent) return;

            // ä» unit4.txt åŠ è½½åŸæ–‡ï¼ˆä½¿ç”¨ fetch æˆ–ç›´æ¥ä½¿ç”¨ lessonDataï¼‰
            const originalText = `1 The Englishman appears to be cold and unemotional because he is really slow. When an event happens, he may understand it quickly enough with his mind, but he takes quite a while to feel it. Once upon a time a coach, containing some Englishmen and some Frenchmen, was driving over the Alps. The horses ran away, and as they were dashing across a bridge the coach caught on the stonework, tottered, and nearly fell into the ravine below. The Frenchmen were frantic with terror: they screamed and gesticulated and flung themselves about, as Frenchmen would. The Englishmen sat quite calm. An hour later, the coach drew up at an inn to change horses, and by that time the situations were exactly reversed. The Frenchmen had forgotten all about the danger, and were chattering gaily; the Englishmen had just begun to feel it, and one had a nervous breakdown and was obliged to go to bed. We have here a clear physical difference between the two races a difference that goes deep into character. The Frenchmen responded at once; the Englishmen responded in time. They were slow and they were also practical. Their instinct forbade them to throw themselves about in the coach, because it was more likely to tip over if they did. They had this extraordinary appreciation of fact that we shall notice again and again. When a disaster comes, the English instinct is to do what can be done first, and to postpone the feeling as long as possible. Hence they are splendid at emergencies. No doubt they are braveâ€”no one will deny that bravery is partly an affair of the nerves, and the English nervous system is well equipped for meeting physical emergency.

2 It acts promptly and feels slowly. Such a combination is fruitful, and anyone who possesses it has gone a long way toward being brave. And when the action is over, then the Englishman can feel.

3 There is one more considerationâ€”a most important one. If the English nature is cold, how is it that it has produced a great literature and a literature that is particularly great in poetry? Judged by its prose, English literature would not stand in the first rank. It is its poetry that raises it to the level of Greek, Persian, or French. And yet the English are supposed to be so unpoetical. How is this? The nation that produced the Elizabethan drama and the Lake Poets cannot be a cold, unpoetical nation. We can't get fire out of ice. Since literature always rests upon national character, there must be in the English nature hidden springs of fire to produce the fire we see. The warm sympathy, the romance, the imagination, that we look for in Englishmen whom we meet, and too often vainly look for, must exist in the nation as a whole, or we could not have this outburst of national song. An undeveloped heart not a cold one.

4 The trouble is that the English nature is not at all easy to understand. It has a great air of simplicity, it advertises itself as simple, but the more we consider it, the greater the problems we shall encounter. People talk of the mysterious East, but the West also is mysterious. It has depths that do not reveal themselves at the first gaze. We know what the sea looks like from a distance: it is of one color, and level, and obviously cannot contain such creatures as fish. But if we look into the sea over the edge of a boat, we see a dozen colors, and depth below depth, and fish swimming in them. That sea is the English character apparently imperturbable and even. These depths and the colors are the English romanticism and the English sensitiveness-we do not expect to find such things, but they exist. Andâ€”to continue my metaphor-the fish are the English emotions, which are always trying to get up to the surface, but don't quite know how. For the most part we see them moving far below, distorted and obscure. Now and then they succeed and we exclaim, "Why, the Englishman has emotions! He actually can feel!" And occasionally we see that beautiful creature the flying fish, which rises out of the water altogether into the air and the sunlight. English literature is a flying fish. It is a sample of the life that goes on day after day beneath the surface; it is a proof that beauty and emotion exist in the salt, inhospitable sea.

5 And now let's get back to terra firma. The Englishman's attitude toward criticism will give us another starting point. He is not annoyed by criticism. He listens or not as the case may be, smiles and passes on, saying, "Oh, the fellow's jealous"; "Oh, I'm used to Bernard ShawÂ° ; monkey tricks don't hurt me." It never occurs to him that the fellow may be accurate as well as jealous, and that he might do well to take the criticism to heart and profit by it. It never strikes him except as a form of wordsâ€” that he is capable of improvement; his self-complacency is abysmal. Other nations, both Oriental and European, have an uneasy feeling that they are not quite perfect. In consequence they resent criticism. It hurts them; and their snappy answers often mask a determination to improve themselves. Not so the Englishman. He has no uneasy feeling. Let the critics bark. And the "tolerant humorous attitude" with which he confronts them is not really humorous, because it is bounded by the titter and the guffaw.`;

            originalTextContent.textContent = originalText;
        }

        // å•è¯æ‹¼å†™åŠŸèƒ½ç®¡ç†å™¨
        const SpellingManager = {
            words: [],
            remainingWords: [],
            selectedLetters: [],
            letterElementsMap: new Map(),
            currentWord: null,
            correctCount: 0,
            totalAnswered: 0,
            isGameStarted: false,
            autoNextTimer: null,
            correctWords: [],      // è®°å½•æ‹¼å†™æ­£ç¡®çš„å•è¯
            givenUpWords: [],      // è®°å½•æ”¾å¼ƒçš„å•è¯

            // åˆå§‹åŒ–å•è¯æ•°æ®
            initWords() {
                if (!window.lessonData || !window.lessonData.paragraphs) {
                    console.warn('è¯¾ç¨‹æ•°æ®æœªåŠ è½½');
                    return;
                }

                this.words = [];
                // ä»æ‰€æœ‰æ®µè½ä¸­æå–è¯æ±‡
                window.lessonData.paragraphs.forEach(paragraph => {
                    if (paragraph.vocabulary && Array.isArray(paragraph.vocabulary)) {
                        paragraph.vocabulary.forEach(vocab => {
                            this.words.push({
                                english: vocab.word,
                                chinese: vocab.meaning
                            });
                        });
                    }
                });

                // å»é‡ï¼ˆæ ¹æ®å•è¯ï¼‰
                const uniqueWords = new Map();
                this.words.forEach(word => {
                    if (!uniqueWords.has(word.english.toLowerCase())) {
                        uniqueWords.set(word.english.toLowerCase(), word);
                    }
                });
                this.words = Array.from(uniqueWords.values());

                console.log(`å·²åŠ è½½ ${this.words.length} ä¸ªå•è¯ç”¨äºæ‹¼å†™ç»ƒä¹ `);
            },

            // å¼€å§‹æ¸¸æˆ
            startGame() {
                if (this.words.length === 0) {
                    alert('æ²¡æœ‰æ‰¾åˆ°å•è¯æ•°æ®ï¼Œè¯·æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®åŠ è½½');
                    return;
                }

                this.isGameStarted = true;
                this.remainingWords = [...this.words];
                this.shuffleArray(this.remainingWords);
                this.correctCount = 0;
                this.totalAnswered = 0;
                this.correctWords = [];
                this.givenUpWords = [];

                // éšè—å¼€å§‹æŒ‰é’®ï¼Œæ˜¾ç¤ºæ¸¸æˆç•Œé¢
                document.getElementById('spelling-start-btn').style.display = 'none';
                document.getElementById('spelling-check-btn').disabled = false;
                document.getElementById('spelling-delete-btn').disabled = false;
                document.getElementById('spelling-retry-btn').disabled = false;
                document.getElementById('spelling-next-btn').disabled = false;
                document.getElementById('spelling-giveup-btn').disabled = false;

                this.setupWord();
            },

            // æ´—ç‰Œç®—æ³•
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            },

            // è®¾ç½®å½“å‰å•è¯
            setupWord() {
                if (this.autoNextTimer) {
                    clearTimeout(this.autoNextTimer);
                    this.autoNextTimer = null;
                }

                if (this.remainingWords.length === 0) {
                    this.completeGame();
                    return;
                }

                const currentWordObj = this.remainingWords[0];
                this.currentWord = currentWordObj.english.toLowerCase();
                const currentHint = currentWordObj.chinese;

                document.getElementById('spelling-hint').textContent = currentHint;
                document.getElementById('spelling-input').value = '';
                this.selectedLetters = [];
                this.letterElementsMap.clear();

                this.createLetterBlocks(this.currentWord);
                this.updateProgress();
            },

            // åˆ›å»ºå­—æ¯å—
            createLetterBlocks(word) {
                const container = document.getElementById('spelling-letters-container');
                container.innerHTML = '';

                const letters = word.split('');
                // å¤åˆ¶å­—æ¯æ•°ç»„å¹¶æ‰“ä¹±
                const shuffledLetters = [...letters];
                this.shuffleArray(shuffledLetters);

                shuffledLetters.forEach((letter, index) => {
                    const letterElement = document.createElement('button');
                    letterElement.className = 'spelling-letter-block';
                    letterElement.textContent = letter;
                    letterElement.dataset.letter = letter;
                    letterElement.dataset.index = index;

                    letterElement.addEventListener('click', () => {
                        if (!letterElement.classList.contains('selected') && !letterElement.disabled) {
                            this.selectLetter(letter, letterElement);
                        }
                    });

                    container.appendChild(letterElement);
                    this.letterElementsMap.set(letterElement, {
                        selected: false,
                        letter: letter
                    });
                });
            },

            // é€‰æ‹©å­—æ¯
            selectLetter(letter, element) {
                this.selectedLetters.push(letter);
                document.getElementById('spelling-input').value = this.selectedLetters.join('');
                element.classList.add('selected');
                this.letterElementsMap.set(element, {
                    selected: true,
                    letter: letter
                });
            },

            // åˆ é™¤æœ€åä¸€ä¸ªå­—æ¯
            deleteLastLetter() {
                if (this.selectedLetters.length === 0) return;

                const letterToRemove = this.selectedLetters.pop();
                document.getElementById('spelling-input').value = this.selectedLetters.join('');

                // æ‰¾åˆ°æœ€åä¸€ä¸ªè¢«é€‰ä¸­ä¸”å­—æ¯åŒ¹é…çš„å­—æ¯å—
                const elements = Array.from(this.letterElementsMap.keys()).reverse();
                for (const element of elements) {
                    const data = this.letterElementsMap.get(element);
                    if (data.selected && data.letter === letterToRemove) {
                        element.classList.remove('selected');
                        this.letterElementsMap.set(element, {
                            selected: false,
                            letter: data.letter
                        });
                        break;
                    }
                }
            },

            // æ£€æŸ¥æ‹¼å†™
            checkSpelling() {
                if (!this.currentWord) return;

                const userInput = this.selectedLetters.join('').toLowerCase();
                const correctWord = this.currentWord.toLowerCase();

                if (userInput === correctWord) {
                    // æ‹¼å†™æ­£ç¡®
                    this.correctCount++;
                    this.totalAnswered++;

                    // è®°å½•æ­£ç¡®çš„å•è¯
                    const currentWordObj = this.remainingWords[0];
                    this.correctWords.push({
                        english: currentWordObj.english,
                        chinese: currentWordObj.chinese
                    });

                    this.updateScore();

                    // ç¦ç”¨æ‰€æœ‰å­—æ¯å—
                    const letterElements = document.querySelectorAll('.spelling-letter-block');
                    letterElements.forEach(el => el.disabled = true);

                    // 2ç§’åè‡ªåŠ¨è·³è½¬ä¸‹ä¸€ä¸ªå•è¯
                    this.autoNextTimer = setTimeout(() => {
                        this.remainingWords.shift();
                        this.setupWord();
                    }, 2000);

                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    const input = document.getElementById('spelling-input');
                    input.style.borderColor = '#10b981';
                    input.style.backgroundColor = '#d1fae5';
                    setTimeout(() => {
                        input.style.borderColor = '';
                        input.style.backgroundColor = '';
                    }, 2000);
                } else {
                    // æ‹¼å†™é”™è¯¯
                    this.totalAnswered++;
                    this.updateScore();
                    alert('æ‹¼å†™é”™è¯¯ï¼Œè¯·é‡è¯•ï¼');

                    // æ˜¾ç¤ºé”™è¯¯æç¤º
                    const input = document.getElementById('spelling-input');
                    input.style.borderColor = '#ef4444';
                    input.style.backgroundColor = '#fee2e2';
                    setTimeout(() => {
                        input.style.borderColor = '';
                        input.style.backgroundColor = '';
                    }, 1000);
                }
            },

            // é‡è¯•å½“å‰å•è¯
            retryWord() {
                document.getElementById('spelling-input').value = '';
                this.selectedLetters = [];

                // é‡ç½®æ‰€æœ‰å­—æ¯å—
                for (const [element, data] of this.letterElementsMap.entries()) {
                    element.classList.remove('selected');
                    element.disabled = false;
                    this.letterElementsMap.set(element, {
                        selected: false,
                        letter: data.letter
                    });
                }
            },

            // è·³åˆ°ä¸‹ä¸€ä¸ªå•è¯
            nextWord() {
                if (this.remainingWords.length > 0) {
                    // è®°å½•æ”¾å¼ƒçš„å•è¯ï¼ˆå¦‚æœå½“å‰å•è¯è¿˜æœªå®Œæˆï¼‰
                    const currentWordObj = this.remainingWords[0];
                    this.givenUpWords.push({
                        english: currentWordObj.english,
                        chinese: currentWordObj.chinese
                    });
                    this.totalAnswered++;
                    this.updateScore();

                    this.remainingWords.shift();
                    this.setupWord();
                }
            },

            // æ”¾å¼ƒå½“å‰å•è¯
            giveUpWord() {
                if (this.remainingWords.length > 0) {
                    this.totalAnswered++;

                    // è®°å½•æ”¾å¼ƒçš„å•è¯
                    const currentWordObj = this.remainingWords[0];
                    this.givenUpWords.push({
                        english: currentWordObj.english,
                        chinese: currentWordObj.chinese
                    });

                    this.updateScore();
                    this.remainingWords.shift();
                    this.setupWord();
                }
            },

            // æ›´æ–°åˆ†æ•°
            updateScore() {
                const score = this.totalAnswered > 0 ? Math.round((this.correctCount / this.totalAnswered) * 100) : 0;
                document.getElementById('spelling-score').textContent = score + '%';
            },

            // æ›´æ–°è¿›åº¦
            updateProgress() {
                const total = this.words.length;
                const remaining = this.remainingWords.length;
                const completed = total - remaining;
                document.getElementById('spelling-progress').textContent = `${completed} / ${total}`;
            },

            // å®Œæˆæ¸¸æˆ
            completeGame() {
                this.isGameStarted = false;
                const finalScore = this.totalAnswered > 0 ? Math.round((this.correctCount / this.totalAnswered) * 100) : 0;
                document.getElementById('spelling-final-score').textContent = finalScore + '%';
                document.getElementById('spelling-complete').classList.remove('hidden');

                // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
                document.getElementById('spelling-check-btn').disabled = true;
                document.getElementById('spelling-delete-btn').disabled = true;
                document.getElementById('spelling-retry-btn').disabled = true;
                document.getElementById('spelling-next-btn').disabled = true;
                document.getElementById('spelling-giveup-btn').disabled = true;
            },

            // å¯¼å‡ºæ‹¼å†™æŠ¥å‘Šä¸ºPDF
            exportSpellingReport() {
                // è·å–ç”¨æˆ·ä¿¡æ¯
                const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
                if (!userInfo.class || !userInfo.name || !userInfo.studentId) {
                    alert('è¯·å…ˆå¡«å†™å­¦ç”Ÿä¿¡æ¯ï¼');
                    return;
                }

                // æ£€æŸ¥html2canvasæ˜¯å¦åŠ è½½
                if (typeof html2canvas === 'undefined') {
                    alert('PDFå¯¼å‡ºåŠŸèƒ½éœ€è¦html2canvasåº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼');
                    return;
                }

                const finalScore = this.totalAnswered > 0 ? Math.round((this.correctCount / this.totalAnswered) * 100) : 0;

                // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æŠ¥å‘Šå®¹å™¨
                const reportContainer = document.createElement('div');
                reportContainer.style.width = '210mm'; // A4å®½åº¦
                reportContainer.style.padding = '20mm';
                reportContainer.style.backgroundColor = '#ffffff';
                reportContainer.style.fontFamily = 'Arial, "Microsoft YaHei", sans-serif';
                reportContainer.style.position = 'absolute';
                reportContainer.style.left = '-9999px';
                reportContainer.style.top = '0';
                document.body.appendChild(reportContainer);

                // ç”ŸæˆæŠ¥å‘ŠHTML
                let reportHTML = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="font-size: 24px; color: #333; margin-bottom: 10px;">å•è¯æ‹¼å†™ç»ƒä¹ æŠ¥å‘Š</h1>
                    </div>
                    <div style="margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px;">
                        <p style="font-size: 14px; margin: 5px 0;"><strong>ç­çº§:</strong> ${userInfo.class}</p>
                        <p style="font-size: 14px; margin: 5px 0;"><strong>å§“å:</strong> ${userInfo.name}</p>
                        <p style="font-size: 14px; margin: 5px 0;"><strong>å­¦å·:</strong> ${userInfo.studentId}</p>
                        <p style="font-size: 14px; margin: 5px 0;"><strong>æäº¤æ—¶é—´:</strong> ${new Date().toLocaleString('zh-CN')}</p>
                    </div>
                    <div style="margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 8px;">
                        <h2 style="font-size: 18px; margin-bottom: 10px;">æ€»ä½“æˆç»©</h2>
                        <p style="font-size: 16px; color: #333;"><strong>æ­£ç¡®ç‡:</strong> ${finalScore}% (ç­”å¯¹ ${this.correctCount} / ${this.totalAnswered} é¢˜)</p>
                        <p style="font-size: 14px; margin: 5px 0;"><strong>æ€»å•è¯æ•°:</strong> ${this.words.length}</p>
                        <p style="font-size: 14px; margin: 5px 0;"><strong>æ‹¼å†™æ­£ç¡®:</strong> ${this.correctWords.length} ä¸ª</p>
                        <p style="font-size: 14px; margin: 5px 0;"><strong>æ”¾å¼ƒå•è¯:</strong> ${this.givenUpWords.length} ä¸ª</p>
                    </div>
                `;

                // æ‹¼å†™æ­£ç¡®çš„å•è¯åˆ—è¡¨
                if (this.correctWords.length > 0) {
                    reportHTML += `
                        <div style="margin-top: 30px; margin-bottom: 20px;">
                            <h2 style="font-size: 18px; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px; color: #10b981;">âœ“ æ‹¼å†™æ­£ç¡®çš„å•è¯</h2>
                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                                <thead>
                                    <tr style="background-color: #f0fdf4; border-bottom: 2px solid #10b981;">
                                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 14px;">åºå·</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 14px;">å•è¯</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 14px;">å«ä¹‰</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    this.correctWords.forEach((word, index) => {
                        reportHTML += `
                            <tr style="background-color: ${index % 2 === 0 ? '#ffffff' : '#f9fafb'};">
                                <td style="padding: 8px; border: 1px solid #ddd; font-size: 13px;">${index + 1}</td>
                                <td style="padding: 8px; border: 1px solid #ddd; font-size: 13px; font-weight: bold; color: #10b981;">${word.english}</td>
                                <td style="padding: 8px; border: 1px solid #ddd; font-size: 13px;">${word.chinese}</td>
                            </tr>
                        `;
                    });
                    reportHTML += `</tbody></table></div>`;
                }

                // æ”¾å¼ƒçš„å•è¯åˆ—è¡¨
                if (this.givenUpWords.length > 0) {
                    reportHTML += `
                        <div style="margin-top: 30px; margin-bottom: 20px;">
                            <h2 style="font-size: 18px; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px; color: #ef4444;">âœ— æ”¾å¼ƒçš„å•è¯</h2>
                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                                <thead>
                                    <tr style="background-color: #fef2f2; border-bottom: 2px solid #ef4444;">
                                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 14px;">åºå·</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 14px;">å•è¯</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 14px;">å«ä¹‰</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    this.givenUpWords.forEach((word, index) => {
                        reportHTML += `
                            <tr style="background-color: ${index % 2 === 0 ? '#ffffff' : '#f9fafb'};">
                                <td style="padding: 8px; border: 1px solid #ddd; font-size: 13px;">${index + 1}</td>
                                <td style="padding: 8px; border: 1px solid #ddd; font-size: 13px; font-weight: bold; color: #ef4444;">${word.english}</td>
                                <td style="padding: 8px; border: 1px solid #ddd; font-size: 13px;">${word.chinese}</td>
                            </tr>
                        `;
                    });
                    reportHTML += `</tbody></table></div>`;
                }

                reportContainer.innerHTML = reportHTML;

                // ä½¿ç”¨html2canvaså°†HTMLè½¬æ¢ä¸ºå›¾ç‰‡
                html2canvas(reportContainer, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    // ä½¿ç”¨jsPDFç”ŸæˆPDF
                    const { jsPDF } = window.jspdf;
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');

                    const imgWidth = 210; // A4å®½åº¦
                    const pageHeight = 297; // A4é«˜åº¦
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    // æ·»åŠ ç¬¬ä¸€é¡µ
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    // å¦‚æœå†…å®¹è¶…è¿‡ä¸€é¡µï¼Œæ·»åŠ æ–°é¡µé¢
                    while (heightLeft > 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    // ç”Ÿæˆæ–‡ä»¶åå¹¶ä¸‹è½½
                    const fileName = `${userInfo.class}-${userInfo.name}-${userInfo.studentId}-å•è¯æ‹¼å†™æŠ¥å‘Š.pdf`;
                    pdf.save(fileName);

                    // æ¸…ç†ä¸´æ—¶å…ƒç´ 
                    document.body.removeChild(reportContainer);

                    console.log('PDFå¯¼å‡ºæˆåŠŸ:', fileName);
                }).catch(error => {
                    console.error('PDFå¯¼å‡ºå¤±è´¥:', error);
                    alert('PDFå¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                    if (document.body.contains(reportContainer)) {
                        document.body.removeChild(reportContainer);
                    }
                });
            }
        };

        // åˆå§‹åŒ–å•è¯æ‹¼å†™åŠŸèƒ½
        function initSpellingGame() {
            // åˆå§‹åŒ–å•è¯æ•°æ®
            SpellingManager.initWords();

            // æ›´æ–°åˆå§‹è¿›åº¦æ˜¾ç¤º
            if (SpellingManager.words.length > 0) {
                document.getElementById('spelling-progress').textContent = `0 / ${SpellingManager.words.length}`;
            }

            // ç»‘å®šäº‹ä»¶
            document.getElementById('spelling-start-btn').addEventListener('click', () => {
                SpellingManager.startGame();
            });

            document.getElementById('spelling-check-btn').addEventListener('click', () => {
                SpellingManager.checkSpelling();
            });

            document.getElementById('spelling-delete-btn').addEventListener('click', () => {
                SpellingManager.deleteLastLetter();
            });

            document.getElementById('spelling-retry-btn').addEventListener('click', () => {
                SpellingManager.retryWord();
            });

            document.getElementById('spelling-next-btn').addEventListener('click', () => {
                SpellingManager.nextWord();
            });

            document.getElementById('spelling-giveup-btn').addEventListener('click', () => {
                SpellingManager.giveUpWord();
            });

            // å¯¼å‡ºPDFæŒ‰é’®
            document.getElementById('spelling-export-pdf-btn').addEventListener('click', () => {
                SpellingManager.exportSpellingReport();
            });

            // é”®ç›˜æ”¯æŒ
            document.addEventListener('keydown', (e) => {
                // åªåœ¨å•è¯æ‹¼å†™åŒºåŸŸå¯è§æ—¶å“åº”
                const spellingContent = document.getElementById('spelling-exercise-content');
                if (!spellingContent || spellingContent.classList.contains('hidden')) return;
                if (!SpellingManager.isGameStarted) return;

                if (e.key === 'Backspace') {
                    e.preventDefault();
                    SpellingManager.deleteLastLetter();
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    SpellingManager.checkSpelling();
                } else if (/^[a-z]$/.test(e.key.toLowerCase())) {
                    // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœªé€‰ä¸­çš„åŒ¹é…å­—æ¯å—
                    for (const [element, data] of SpellingManager.letterElementsMap.entries()) {
                        if (!data.selected && data.letter === e.key.toLowerCase() && !element.disabled) {
                            SpellingManager.selectLetter(e.key.toLowerCase(), element);
                            break;
                        }
                    }
                }
            });
        }

        // ç”¨æˆ·ä¿¡æ¯è¡¨å•å¤„ç†
        function initUserInfoForm() {
            const userInfoModal = document.getElementById('user-info-modal');
            const userInfoForm = document.getElementById('user-info-form');

            // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç”¨æˆ·ä¿¡æ¯
            const savedUserInfo = localStorage.getItem('userInfo');
            if (savedUserInfo) {
                const userInfo = JSON.parse(savedUserInfo);
                // å¦‚æœä¿¡æ¯å®Œæ•´ï¼Œéšè—æ¨¡æ€æ¡†
                if (userInfo.class && userInfo.name && userInfo.studentId) {
                    userInfoModal.classList.add('hidden');
                    return;
                }
            }

            // è¡¨å•æäº¤
            userInfoForm.addEventListener('submit', function (e) {
                e.preventDefault();

                const userInfo = {
                    class: document.getElementById('user-class').value.trim(),
                    name: document.getElementById('user-name').value.trim(),
                    studentId: document.getElementById('user-id').value.trim()
                };

                if (!userInfo.class || !userInfo.name || !userInfo.studentId) {
                    alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï¼');
                    return;
                }

                // ä¿å­˜åˆ°localStorage
                localStorage.setItem('userInfo', JSON.stringify(userInfo));

                // éšè—æ¨¡æ€æ¡†
                userInfoModal.classList.add('hidden');

                console.log('ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜:', userInfo);
            });
        }

        // å¯¼å‡ºPDFæŒ‰é’®äº‹ä»¶
        function initExportPDF() {
            const exportBtn = document.getElementById('export-pdf-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', function () {
                    if (typeof window.exerciseManager !== 'undefined') {
                        window.exerciseManager.exportToPDF();
                    }
                });
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–å†…å®¹æ¸²æŸ“å™¨...');

            // æ–°å¢ï¼šæ‚¬æµ®çª—å…³é—­åŠŸèƒ½
            const floatingWindow = document.getElementById('floating-window');
            const closeFloatingWindowBtn = document.getElementById('close-floating-window');
            if (floatingWindow && closeFloatingWindowBtn) {
                closeFloatingWindowBtn.addEventListener('click', () => {
                    floatingWindow.style.display = 'none';
                });
            }

            // åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯è¡¨å•
            initUserInfoForm();

            // åˆå§‹åŒ–å¯¼å‡ºPDFåŠŸèƒ½
            initExportPDF();

            // ç¡®ä¿æ•°æ®å·²åŠ è½½
            if (typeof window.lessonData === 'undefined') {
                console.error('è¯¾ç¨‹æ•°æ®æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ unit4.js æ–‡ä»¶');
                return;
            }

            // æ›´æ–°é¡µé¢æ ‡é¢˜ä¿¡æ¯
            document.getElementById('course-unit').textContent = 'Unit 4';
            document.getElementById('course-title').textContent = 'A Note on the Slowness of the English Character';

            // åˆå§‹åŒ–æ ‡ç­¾é¡µå¯¼èˆª
            initTabNavigation();

            // åˆå§‹åŒ–ç»ƒä¹ ç±»å‹å­æ ‡ç­¾å¯¼èˆª
            initExerciseTabNavigation();

            // åˆå§‹åŒ–é˜…è¯»æ¨¡å¼å­æ ‡ç­¾å¯¼èˆª
            initSubTabNavigation();

            // åˆå§‹åŒ–å•è¯æ‹¼å†™åŠŸèƒ½
            initSpellingGame();

            // åˆå§‹åŒ–å¯†ç éªŒè¯
            initPasswordVerification();

            // åŠ è½½åŸæ–‡å†…å®¹
            loadOriginalText();

            // åˆå§‹åŒ–å†…å®¹æ¸²æŸ“å™¨ï¼ˆä»…ç”¨äºæ³¨é‡Šé˜…è¯»æ¨¡å¼ï¼‰
            if (typeof window.contentRenderer !== 'undefined') {
                // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œåªåœ¨æ³¨é‡Šé˜…è¯»æ¨¡å¼ä¸‹ä½¿ç”¨
                console.log('å†…å®¹æ¸²æŸ“å™¨å·²åŠ è½½ï¼Œå°†åœ¨æ³¨é‡Šé˜…è¯»æ¨¡å¼ä¸‹åˆå§‹åŒ–');
            } else {
                console.error('å†…å®¹æ¸²æŸ“å™¨æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ content-renderer.js æ–‡ä»¶');
            }

            // åˆå§‹åŒ–åŠ¨ç”»æ•ˆæœ
            initAnimations();
        });

        // åˆå§‹åŒ–åŠ¨ç”»æ•ˆæœ
        function initAnimations() {
            // åˆ›å»ºé¼ æ ‡è·Ÿéšå…‰æ ‡æ•ˆæœ
            const cursorGlow = document.createElement('div');
            cursorGlow.className = 'cursor-glow';
            document.body.appendChild(cursorGlow);

            document.addEventListener('mousemove', (e) => {
                cursorGlow.style.left = e.clientX + 'px';
                cursorGlow.style.top = e.clientY + 'px';
            });

            // åˆ›å»ºèƒŒæ™¯ç²’å­æ•ˆæœ
            createParticles();

            // ä¸ºæŒ‰é’®æ·»åŠ æ³¢çº¹æ•ˆæœ
            document.querySelectorAll('button').forEach(button => {
                button.classList.add('btn-ripple');
                button.addEventListener('click', createRipple);
            });

            // æ·»åŠ é¡µé¢ç‚¹å‡»æ³¡æ³¡æ•ˆæœ
            document.addEventListener('click', createClickBubble);

            // é¡µé¢åŠ è½½åŠ¨ç”»
            document.querySelectorAll('main > *').forEach((element, index) => {
                element.classList.add('page-load-animation');
                element.style.animationDelay = `${index * 0.1}s`;
            });
        }

        // åˆ›å»ºèƒŒæ™¯ç²’å­æ•ˆæœ
        function createParticles() {
            const particleCount = 15;
            const colors = ['#8b5cf6', '#ec4899', '#14b8a6'];

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';

                const size = Math.random() * 4 + 2;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const duration = Math.random() * 15 + 10;
                const delay = Math.random() * 5;

                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.background = color;
                particle.style.borderRadius = '50%';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animation = `particleFloat ${duration}s linear ${delay}s infinite`;

                document.body.appendChild(particle);
            }
        }

        // åˆ›å»ºæ³¢çº¹æ•ˆæœ
        function createRipple(e) {
            const button = e.currentTarget;
            const ripple = document.createElement('span');
            const rect = button.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;

            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.classList.add('ripple-effect');

            button.appendChild(ripple);

            setTimeout(() => {
                ripple.remove();
            }, 600);
        }

        // åˆ›å»ºç‚¹å‡»æ³¡æ³¡æ•ˆæœ
        function createClickBubble(e) {
            // é¿å…åœ¨æŒ‰é’®ä¸Šè§¦å‘æ³¡æ³¡æ•ˆæœ
            if (e.target.closest('button')) {
                return;
            }

            const bubble = document.createElement('div');
            bubble.className = 'click-bubble';

            // éšæœºé¢œè‰²ï¼Œä½¿ç”¨ä¸é¡µé¢ä¸»é¢˜ç›¸ç¬¦çš„é¢œè‰²
            const colors = [
                'rgba(139, 92, 246, 0.6)',   // ç´«è‰²
                'rgba(236, 72, 153, 0.6)',   // ç²‰è‰²
                'rgba(20, 184, 166, 0.6)'    // é’ç»¿è‰²
            ];
            bubble.style.background = colors[Math.floor(Math.random() * colors.length)];
            bubble.style.left = e.clientX + 'px';
            bubble.style.top = e.clientY + 'px';

            document.body.appendChild(bubble);

            // åˆ›å»ºç ´è£‚ç²’å­æ•ˆæœ
            setTimeout(() => {
                createBubbleParticles(e.clientX, e.clientY);
            }, 400);

            // ç§»é™¤æ³¡æ³¡
            setTimeout(() => {
                bubble.remove();
            }, 800);
        }

        // åˆ›å»ºç ´è£‚ç²’å­æ•ˆæœ
        function createBubbleParticles(x, y) {
            const particleCount = 8;
            const colors = [
                'rgba(139, 92, 246, 0.8)',
                'rgba(236, 72, 153, 0.8)',
                'rgba(20, 184, 166, 0.8)'
            ];

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'bubble-particle';

                const color = colors[Math.floor(Math.random() * colors.length)];
                const angle = (360 / particleCount) * i;
                const distance = 30 + Math.random() * 40;
                const finalX = x + Math.cos(angle * Math.PI / 180) * distance;
                const finalY = y + Math.sin(angle * Math.PI / 180) * distance;

                particle.style.background = color;
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';

                // è‡ªå®šä¹‰åŠ¨ç”»è·¯å¾„
                const animation = particle.animate([
                    {
                        transform: 'translate(-50%, -50%) scale(0)',
                        opacity: 1
                    },
                    {
                        transform: `translate(${finalX - x}px, ${finalY - y}px) scale(1)`,
                        opacity: 0.8
                    },
                    {
                        transform: `translate(${finalX - x}px, ${finalY - y}px) scale(0.3)`,
                        opacity: 0
                    }
                ], {
                    duration: 800,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                });

                document.body.appendChild(particle);

                // åŠ¨ç”»ç»“æŸåç§»é™¤ç²’å­
                animation.onfinish = () => {
                    particle.remove();
                };
            }
        }

        // ä¸ºä¸»è¦å¡ç‰‡æ·»åŠ æ‚¬æµ®æ•ˆæœ
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(() => {
                document.querySelectorAll('.glass-effect').forEach(element => {
                    element.classList.add('hover-float');
                });
            }, 1000);
        });
    </script>
</body>

</html>